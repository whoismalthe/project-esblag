<!doctype html>
<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Project ESBLAG ‚Äî MVP</title>

    <!-- Friendly, playful font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400..700&family=Nunito:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
      :root{
        --bg: #fbfbff;
        --ink: #16213e;
        --muted: #667085;
        --brand: #6c5ce7;   
        --brand-2: #00c2ff; 
        --brand-3: #00d68f; 
        --danger: #ef476f;
        --ok: #06d6a0;
        --card: #ffffff;
        --shadow: 0 10px 30px rgba(22, 33, 62, 0.08);
        --radius: 16px;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        background:
          radial-gradient(1200px 600px at 10% -10%, rgba(108,92,231,.15), transparent),
          radial-gradient(1000px 800px at 110% 20%, rgba(0,200,255,.12), transparent),
          radial-gradient(900px 700px at 50% 120%, rgba(0,214,143,.12), transparent),
          var(--bg);
        color:var(--ink);
        font-family: "Nunito", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        line-height:1.5;
      }
      header{
        position:sticky; top:0; z-index:5;
        background:rgba(255,255,255,.75);
        backdrop-filter: blur(6px);
        border-bottom:1px solid rgba(0,0,0,.05);
      }
      .wrap{max-width:1000px; margin:0 auto; padding:16px;}
      .row{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
      .brand{
        display:flex; align-items:center; gap:12px; font-weight:900; letter-spacing:.3px;
      }
      .brand .logo{
        width:40px; height:40px; border-radius:50%;
        display:grid; place-items:center; color:white;
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        box-shadow: var(--shadow);
        font-family: "Fredoka", sans-serif; font-weight:700;
      }
      .spacer{flex:1}
      .pill{font-weight:700; font-size:14px; padding:8px 12px; border-radius:999px; background:#f1f5f9; color:#0f172a}

      button{
        border:0; cursor:pointer; font-weight:800; letter-spacing:.3px;
        border-radius:12px; padding:14px 18px; transition: transform .06s ease, box-shadow .2s ease;
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        color:white; box-shadow: var(--shadow);
      }
      button:hover{ transform: translateY(-1px) }
      button.secondary{ background:#eef2ff; color:#3730a3 }
      button.ghost{ background:transparent; color:var(--ink); box-shadow:none; }

      main{ padding:32px 16px; }
      .grid{ display:grid; gap:24px; grid-template-columns: 1.1fr .9fr; align-items:stretch; }
      @media (max-width: 860px){ .grid{ grid-template-columns: 1fr } }
      .card{ background:var(--card); border-radius:var(--radius); box-shadow: var(--shadow); padding:20px; overflow:hidden; }
      .welcome{ display:grid; gap:16px; }
      .big-title{ font-family:"Fredoka", sans-serif; font-weight:800; font-size: clamp(28px, 4vw, 44px); line-height:1.1 }
      .subtitle{ color:var(--muted); font-size:18px }

      .auth-form label{ display:block; font-weight:800; margin:12px 0 4px }
      .auth-form input{
        width:100%; padding:14px 16px; border-radius:12px; border:2px solid #e2e8f0;
        font-size:16px; outline: none; transition: border-color .2s ease;
        background:#f8fafc;
      }
      .auth-form input:focus{ border-color: var(--brand) }
      .hint{ color:var(--muted); font-size:14px }
      .error{ color:var(--danger); font-weight:800 }

      .pet{ display:flex; align-items:center; gap:16px; }
      .pet .bubble{
        width:80px; height:80px; border-radius:20px; display:grid; place-items:center;
        font-size:40px; background: linear-gradient(135deg, #fff, #f5f3ff);
        border:2px dashed #e9d5ff;
        transition: transform .5s ease;
      }
      .level-box{ font-weight:800 }
      .xpbar{ height:12px; background:#e2e8f0; border-radius:999px; overflow:hidden; }
      .xpbar > span{ display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--brand), var(--brand-3)); transition: width .5s ease }

      .quiz{ display:grid; gap:18px; }
      .question{ font-size:20px; font-weight:800 }

      /* Store, klikbare svar-knapper ‚Äì h√∏j kontrast */
      .options{ display:grid; gap:12px }
      .answer-btn{
        display:block; width:100%; text-align:left;
        padding:14px 16px; border-radius:12px; border:2px solid #cbd5e1;
        background:#f1f5f9;
        color:var(--ink);
        font-weight:800; cursor:pointer;
        transition: transform .04s ease, border-color .15s ease, background .15s ease, color .15s ease;
      }
      .answer-btn:hover{ transform: translateY(-1px); background:#e2e8f0; }
      .answer-btn.selected{
        border-color: var(--brand);
        background: var(--brand);
        color: white;
      }

      .muted{ color:var(--muted) }
      .small{ font-size:13px }
      .center{ text-align:center }

      /* Toast for level-up */
      .toast {
        position: fixed; left: 50%; top: 16px; transform: translateX(-50%);
        background: #111827; color: #fff; padding: 12px 16px; border-radius: 12px;
        box-shadow: var(--shadow); opacity: 0; pointer-events: none;
        transition: opacity .3s ease, transform .3s ease;
        z-index: 9999;
      }
      .toast.show { opacity: 1; transform: translateX(-50%) translateY(6px); }

      /* Confetti */
      .confetti {
        position: fixed;
        width: 10px; height: 10px;
        background-color: red;
        z-index: 9998;
        animation: fall linear forwards;
      }
      @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }

      /* Bounce keyframes */
      @keyframes pop { 0%,100%{transform:scale(1)} 50%{transform:scale(1.25)} }
    </style>
  </head>
  <body>
    <header>
      <div class="wrap row">
        <div class="brand">
          <div class="logo">ES</div>
          <div>
            Project ESBLAG
            <div class="small muted">Education Should Be Like A Game</div>
          </div>
        </div>
        <div class="spacer"></div>
        <div id="userBadge" class="pill" style="display:none"></div>
        <button id="logoutBtn" class="ghost" style="display:none">Log ud</button>
      </div>
    </header>

    <main class="wrap">
      <!-- SECTION: Welcome -->
      <section id="welcome" style="display:none">
        <div class="grid">
          <div class="card welcome">
            <div class="big-title">Velkommen, <span id="welcomeName">ven</span>! üéâ</div>
            <div class="subtitle">L√¶ring skal f√∏les som et spil. Tjen XP for rigtige svar, g√• op i level ‚Äî og se dit lille l√¶rings-k√¶ledyr udvikle sig!</div>
            <div class="pet">
              <div class="bubble" id="petEmoji">üê£</div>
              <div>
                <div class="level-box">Level <span id="levelText">1</span></div>
                <div class="xpbar"><span id="xpFill" style="width:0%"></span></div>
                <div class="small muted" id="xpLabel">0 / 50 XP til n√¶ste level</div>
              </div>
            </div>
            <div class="row" style="margin-top:8px">
              <button id="startQuizBtn">Start quiz</button>
              <button class="secondary" id="aboutBtn">Hvad er dette?</button>
            </div>
            <div class="small muted">PS: Denne prototype gemmer kun p√• din egen enhed.</div>
          </div>

          <div class="card">
            <h3 style="margin-top:0">Hurtig info</h3>
            <ul>
              <li>10 sp√∏rgsm√•l ‚Ä¢ multiple choice</li>
              <li>+10 XP pr. rigtigt svar</li>
              <li>XP-krav stiger pr. level (50, 70, 90...)</li>
              <li>Perfekt runde = +1 üî• streak (XP-multiplikator)</li>
              <li>Streak √∏ger XP: x(1 + 0.2 √ó streak)</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- About -->
      <section id="about" style="display:none">
        <div class="card">
          <h2>Hvad er Project ESBLAG?</h2>
          <p>En enkel MVP, der viser hvordan gamification kan g√∏re l√¶ring sjovere: XP, levels og et lille k√¶ledyr, der udvikler sig.</p>
          <button class="secondary" id="backHomeBtn">Tilbage</button>
        </div>
      </section>

      <!-- Auth -->
      <section id="auth" style="display:none">
        <div class="grid">
          <div class="card">
            <h2 class="big-title">Kom i gang ‚ú®</h2>
            <form id="authForm" class="auth-form" autocomplete="off">
              <label for="name">Hvad hedder du?</label>
              <input id="name" name="name" required minlength="2" maxlength="24" />
              <label for="age">Hvor gammel er du?</label>
              <input id="age" name="age" type="number" required min="8" max="99" />
              <div id="authError" class="error" style="display:none"></div>
              <div class="row" style="margin-top:14px">
                <button type="submit">Start</button>
                <button type="reset" class="ghost" id="authReset">Ryd</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- Quiz -->
      <section id="quiz" style="display:none">
        <div class="card">
          <div class="row" style="justify-content:space-between; align-items:center">
            <div><strong>Quiz</strong> ‚Ä¢ <span id="qProgress">1 / 10</span></div>
            <div class="small muted">Streak: <span id="streakBadgeQuiz">0</span></div>
          </div>
          <div class="quiz" style="margin-top:16px">
            <div id="qText" class="question">Sp√∏rgsm√•lstekst</div>
            <div id="qOptions" class="options"></div>
            <div class="row">
              <button id="nextBtn">N√¶ste</button>
              <button id="cancelQuizBtn" class="ghost">Afbryd</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Result -->
      <section id="result" style="display:none">
        <div class="card center">
          <h2 id="resultTitle" style="margin-top:0">Flot klaret! üéØ</h2>
          <p>Du fik <strong><span id="correctCount">0</span>/<span id="totalCount">0</span></strong> rigtige.</p>
          <p>Du tjente <strong><span id="xpEarned">0</span> XP</strong> <span id="streakNote" class="small muted"></span>.</p>
          <div style="max-width:520px; margin: 0 auto 16px">
            <div class="pet" style="justify-content:center">
              <div class="bubble" id="petEmojiResult">üê£</div>
              <div>
                <div class="level-box">Level <span id="levelTextResult">1</span></div>
                <div class="xpbar"><span id="xpFillResult"></span></div>
                <div class="small muted" id="xpLabelResult">0 / 50 XP til n√¶ste level</div>
              </div>
            </div>
          </div>
          <!-- Wrong answers -->
          <div id="wrongAnswers" style="margin-top:16px; text-align:left; display:none;">
            <h3>Forkerte svar:</h3>
            <ul id="wrongList"></ul>
          </div>

          <div class="row" style="justify-content:center; gap:10px">
            <button id="retryBtn">Pr√∏v quizzen igen</button>
            <button class="secondary" id="homeBtn">Til velkomst</button>
          </div>
        </div>
      </section>
    </main>

    <div id="toast" class="toast" aria-live="polite"></div>

    <script>
      // ===============================
      // State & XP Helpers (progressive XP)
      // ===============================
      let currentUser = null;

      const STORAGE_KEY = 'esblag_user_v1';
      const XP_PER_CORRECT = 10;               // +10 XP pr. korrekt svar
      const STREAK_STEP = 0.2;                 // +20% XP pr. streak-niveau

      // Progressive XP-kurve: 1‚Üí2: 50, 2‚Üí3: 70, 3‚Üí4: 90, ...
      function xpRequiredForLevel(level){ return 50 + Math.max(0,(level-1))*20; }
      function totalXpForLevel(level){ let t=0; for(let L=1; L<level; L++) t+=xpRequiredForLevel(L); return t; }
      function getLevel(xp){ let L=1; while(xp >= totalXpForLevel(L+1)) L++; return L; }
      function getXPIntoLevel(xp){ const L=getLevel(xp); return xp - totalXpForLevel(L); }
      function getXPPercent(xp){
        const L=getLevel(xp);
        const into=getXPIntoLevel(xp);
        const need=xpRequiredForLevel(L);
        return Math.round(100*into/need);
      }

      // K√¶ledyr udvikling
      function petForLevel(level){
        if(level<=1) return 'üê£';
        if(level<=2) return 'üê•';
        if(level<=4) return 'üê¶';
        if(level<=7) return 'ü¶Ö';
        return 'üêâ';
      }

      // Storage + auth
      function loadUser(){
        try{ const raw = localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw) : null; }
        catch(e){ return null; }
      }
      function saveUser(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(currentUser)); }
      function logout(){ localStorage.removeItem(STORAGE_KEY); currentUser=null; showSection('auth'); updateHeader(); }

      // UI helpers
      function updateHeader(){
        const badge = document.getElementById('userBadge');
        const logoutBtn = document.getElementById('logoutBtn');
        if(currentUser){
          const lvl = getLevel(currentUser.xp || 0);
          const streak = currentUser.streak || 0;
          const streakTxt = streak>0 ? ` ‚Ä¢ üî•${streak}` : '';
          badge.textContent = `${currentUser.name} ‚Ä¢ ${currentUser.age} √•r ‚Ä¢ Lvl ${lvl}${streakTxt}`;
          badge.style.display = '';
          logoutBtn.style.display = '';
        }else{
          badge.style.display = 'none';
          logoutBtn.style.display = 'none';
        }
      }

      function updatePetWidgets(){
        if(!currentUser) return;
        const level = getLevel(currentUser.xp || 0);
        const percent = getXPPercent(currentUser.xp || 0);
        const into = getXPIntoLevel(currentUser.xp || 0);
        const need = xpRequiredForLevel(level);

        // Welcome
        document.getElementById('welcomeName').textContent = currentUser.name;
        document.getElementById('petEmoji').textContent = petForLevel(level);
        document.getElementById('levelText').textContent = level;
        document.getElementById('xpFill').style.width = percent + '%';
        document.getElementById('xpLabel').textContent = `${into} / ${need} XP til n√¶ste level`;

        // Result
        document.getElementById('petEmojiResult').textContent = petForLevel(level);
        document.getElementById('levelTextResult').textContent = level;
        document.getElementById('xpFillResult').style.width = percent + '%';
        document.getElementById('xpLabelResult').textContent = `${into} / ${need} XP til n√¶ste level`;

        // Quiz top streak badge
        const sbq = document.getElementById('streakBadgeQuiz');
        if (sbq) sbq.textContent = (currentUser.streak||0);
      }

      function showSection(id){
        ['welcome','auth','quiz','result','about'].forEach(sec => {
          document.getElementById(sec).style.display = (sec === id) ? '' : 'none';
        });
      }

      function showToast(msg){
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
      }

      // Level-up effekter
      function playLevelUpEffects(){
        ['petEmoji','petEmojiResult'].forEach(id=>{
          const el = document.getElementById(id);
          if(!el) return;
          el.style.animation = 'none';
          el.offsetHeight;
          el.style.animation = 'pop 800ms ease';
        });
        launchConfetti(140);
      }
      function launchConfetti(n=120){
        for(let i=0;i<n;i++){
          const piece = document.createElement('div');
          const size = 6 + Math.random()*6;
          piece.className = 'confetti';
          piece.style.left = (Math.random()*100) + 'vw';
          piece.style.top = '-12px';
          piece.style.width = size + 'px';
          piece.style.height = size + 'px';
          piece.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`;
          piece.style.opacity = '0.9';
          piece.style.borderRadius = '2px';
          piece.style.animationDuration = (1.8 + Math.random()*1.2) + 's';
          document.body.appendChild(piece);
          setTimeout(()=> piece.remove(), 3200);
        }
      }

      // ===============================
      // Quiz Engine
      // ===============================
      const QUESTIONS = [
        { text: 'Hvad er 7 + 5?', options: ['10','12','13','14'], correctIndex: 1 },
        { text: 'Hvilken planet kaldes den r√∏de planet?', options: ['Venus','Jorden','Mars','Saturn'], correctIndex: 2 },
        { text: 'Hvad hedder Danmarks hovedstad?', options: ['Aarhus','K√∏benhavn','Odense','Esbjerg'], correctIndex: 1 },
        { text: 'Hvilket sprog taler man i Spanien?', options: ['Fransk','Italiensk','Spansk','Tysk'], correctIndex: 2 },
        { text: 'Hvor mange minutter er der i en time?', options: ['30','45','60','90'], correctIndex: 2 },
        { text: 'Hvad kaldes resultatet af et multiplikationsstykke?', options: ['Sum','Kvotient','Produkt','Differens'], correctIndex: 2 },
        { text: 'Hvilket dyr er kendt for at have en lang hals?', options: ['Giraf','Hest','Kanin','Krokodille'], correctIndex: 0 },
        { text: 'Hvad er vandets frysepunkt i ¬∞C?', options: ['0¬∞C','10¬∞C','-10¬∞C','32¬∞C'], correctIndex: 0 },
        { text: 'Hvilket hav ligger mellem Europa og Afrika?', options: ['Stillehavet','Middelhavet','Atlanten','Det Indiske Ocean'], correctIndex: 1 },
        { text: 'Hvad er 9 √ó 3?', options: ['18','21','27','36'], correctIndex: 2 },
      ];

      let qIndex = 0;
      let selections = [];

      function startQuiz(){
        qIndex = 0;
        selections = new Array(QUESTIONS.length).fill(null);
        renderQuestion();
        showSection('quiz');
      }

      // Store, klikbare svar-knapper
      function renderQuestion(){
        const q = QUESTIONS[qIndex];
        document.getElementById('qText').textContent = q.text;
        document.getElementById('qProgress').textContent = `${qIndex+1} / ${QUESTIONS.length}`;

        const box = document.getElementById('qOptions');
        box.innerHTML = '';
        q.options.forEach((opt, i) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'answer-btn' + (selections[qIndex]===i ? ' selected' : '');
          btn.textContent = opt;
          btn.addEventListener('click', () => {
            selections[qIndex] = i;
            // opdater visuel markering
            [...box.querySelectorAll('.answer-btn')].forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
          });
          box.appendChild(btn);
        });

        document.getElementById('nextBtn').textContent = (qIndex === QUESTIONS.length - 1) ? 'Afslut' : 'N√¶ste';
      }

      function nextQuestion(){
        if(qIndex < QUESTIONS.length - 1){
          qIndex++;
          renderQuestion();
        }else{
          finishQuiz();
        }
      }

      function finishQuiz(){
        // T√¶l rigtige og saml forkerte
        let correct = 0;
        const wrongItems = [];
        QUESTIONS.forEach((q, i) => {
          if(selections[i] === q.correctIndex){
            correct++;
          } else {
            wrongItems.push({
              q: q.text,
              your: (Number.isInteger(selections[i]) ? q.options[selections[i]] : '‚Äî'),
              right: q.options[q.correctIndex]
            });
          }
        });

        const xpBefore = currentUser.xp || 0;
        const levelBefore = getLevel(xpBefore);

        // Basis- XP for rigtige svar
        const baseXP = correct * XP_PER_CORRECT;

        // Streak: +1 ved perfekt runde, ellers 0
        let streak = currentUser.streak || 0;
        const perfect = (correct === QUESTIONS.length);
        if (perfect){
          streak = streak + 1;
        } else {
          streak = 0;
        }
        currentUser.streak = streak;

        // XP-multiplikator baseret p√• streak (x(1 + 0.2 * streak))
        const multiplier = 1 + STREAK_STEP * streak;
        const earned = Math.round(baseXP * multiplier);

        // Opdater XP og gem
        currentUser.xp = xpBefore + earned;
        saveUser();

        // Resultatvisning
        const levelAfter = getLevel(currentUser.xp || 0);
        const titleEl = document.getElementById('resultTitle');
        if (titleEl) titleEl.textContent = perfect ? 'Perfekt! üåü' : 'Flot klaret! üéØ';

        document.getElementById('correctCount').textContent = correct;
        document.getElementById('totalCount').textContent = QUESTIONS.length;
        document.getElementById('xpEarned').textContent = earned;

        // Streak-note (x-multiplikator)
        const sn = document.getElementById('streakNote');
        if (streak > 0){
          sn.textContent = `(üî•${streak} ‚Ä¢ x${multiplier.toFixed(1)} bonus)`;
        } else {
          sn.textContent = `(streak nulstillet)`;
        }

        // Fejloversigt
        const wrongWrap = document.getElementById('wrongAnswers');
        const wrongList = document.getElementById('wrongList');
        if(wrongItems.length === 0){
          wrongWrap.style.display = 'none';
          wrongList.innerHTML = '';
        }else{
          wrongWrap.style.display = '';
          wrongList.innerHTML = wrongItems.map(item => `
            <li style="margin-bottom:10px; background:#fff1f2; border:1px solid #fecdd3; padding:8px 10px; border-radius:10px;">
              <div style="font-weight:800;">${item.q}</div>
              <div style="color:#b91c1c;">Dit svar: ${item.your}</div>
              <div style="color:#065f46; font-weight:800;">Korrekt svar: ${item.right}</div>
            </li>
          `).join('');
        }

        // Opdater UI-state (badge/pet/xp + streak badge)
        updateHeader();
        updatePetWidgets();

        // Level-up effekter (kun n√•r XP naturligt passerer gr√¶nsen)
        if (levelAfter > levelBefore){
          showToast(`üéâ Level up! ${levelBefore} ‚Üí ${levelAfter}`);
          playLevelUpEffects();
        }

        showSection('result');
      }

      // Events
      document.getElementById('logoutBtn').addEventListener('click', logout);
      const authForm = document.getElementById('authForm');
      const authError = document.getElementById('authError');
      authForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = authForm.name.value.trim();
        const age = parseInt(authForm.age.value, 10);

        if(!name || !Number.isFinite(age)){
          authError.textContent = 'Udfyld venligst navn og alder.';
          authError.style.display = '';
          return;
        }
        if(age < 8 || age > 99){
          authError.textContent = 'Alderen virker forkert. Pr√∏v igen.';
          authError.style.display = '';
          return;
        }
        authError.style.display = 'none';

        currentUser = { name, age, xp: 0, streak: 0 };
        saveUser();
        updateHeader();
        updatePetWidgets();
        showSection('welcome');
      });
      document.getElementById('authReset').addEventListener('click', () => {
        authError.style.display = 'none';
      });

      document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
      document.getElementById('aboutBtn').addEventListener('click', () => showSection('about'));
      document.getElementById('backHomeBtn').addEventListener('click', () => showSection('welcome'));

      document.getElementById('nextBtn').addEventListener('click', nextQuestion);
      document.getElementById('cancelQuizBtn').addEventListener('click', () => showSection('welcome'));

      document.getElementById('retryBtn').addEventListener('click', startQuiz);
      document.getElementById('homeBtn').addEventListener('click', () => showSection('welcome'));

      // App Init
      (function init(){
        const existing = loadUser();
        if(existing){
          currentUser = existing;
          if (typeof currentUser.xp !== 'number') currentUser.xp = 0;
          if (typeof currentUser.streak !== 'number') currentUser.streak = 0;
          updateHeader();
          updatePetWidgets();
          showSection('welcome');
        }else{
          showSection('auth');
        }
        renderQuestion();
      })();
    </script>
  </body>
</html>

